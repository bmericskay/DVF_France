<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="B. Mericskay et F. Demoraes">
<meta name="dcterms.date" content="2023-01-01">

<title>DVF_France</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="DVF_France_files/libs/clipboard/clipboard.min.js"></script>
<script src="DVF_France_files/libs/quarto-html/quarto.js"></script>
<script src="DVF_France_files/libs/quarto-html/popper.min.js"></script>
<script src="DVF_France_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="DVF_France_files/libs/quarto-html/anchor.min.js"></script>
<link href="DVF_France_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="DVF_France_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="DVF_France_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="DVF_France_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="DVF_France_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#emplacement-du-projet" id="toc-emplacement-du-projet" class="nav-link active" data-scroll-target="#emplacement-du-projet">Emplacement du projet</a></li>
  <li><a href="#packages-nécessaires" id="toc-packages-nécessaires" class="nav-link" data-scroll-target="#packages-nécessaires">Packages nécessaires</a></li>
  <li><a href="#analyser-les-données-dvf-à-léchelle-de-la-france" id="toc-analyser-les-données-dvf-à-léchelle-de-la-france" class="nav-link" data-scroll-target="#analyser-les-données-dvf-à-léchelle-de-la-france">Analyser les données DVF à l’échelle de la France</a></li>
  <li><a href="#préparation-du-jeu-de-données" id="toc-préparation-du-jeu-de-données" class="nav-link" data-scroll-target="#préparation-du-jeu-de-données">Préparation du jeu de données</a>
  <ul class="collapse">
  <li><a href="#téléchargement-et-chargement-du-jeu-de-données-dans-r" id="toc-téléchargement-et-chargement-du-jeu-de-données-dans-r" class="nav-link" data-scroll-target="#téléchargement-et-chargement-du-jeu-de-données-dans-r">Téléchargement et chargement du jeu de données dans R</a></li>
  <li><a href="#filtre-et-nettoyage-des-données" id="toc-filtre-et-nettoyage-des-données" class="nav-link" data-scroll-target="#filtre-et-nettoyage-des-données">Filtre et nettoyage des données</a></li>
  <li><a href="#suppression-des-doublons-et-des-mutations-multiventes" id="toc-suppression-des-doublons-et-des-mutations-multiventes" class="nav-link" data-scroll-target="#suppression-des-doublons-et-des-mutations-multiventes">Suppression des doublons et des mutations multiventes</a></li>
  <li><a href="#suppression-des-valeurs-aberrantes" id="toc-suppression-des-valeurs-aberrantes" class="nav-link" data-scroll-target="#suppression-des-valeurs-aberrantes">Suppression des valeurs aberrantes</a></li>
  <li><a href="#création-de-la-variable-de-prix-au-m²-et-filtre-des-valeurs-extrêmes-et-aberrantes" id="toc-création-de-la-variable-de-prix-au-m²-et-filtre-des-valeurs-extrêmes-et-aberrantes" class="nav-link" data-scroll-target="#création-de-la-variable-de-prix-au-m²-et-filtre-des-valeurs-extrêmes-et-aberrantes">Création de la variable de prix au m² et filtre des valeurs extrêmes et aberrantes</a></li>
  </ul></li>
  <li><a href="#enrichissement-du-jeu-de-données" id="toc-enrichissement-du-jeu-de-données" class="nav-link" data-scroll-target="#enrichissement-du-jeu-de-données">Enrichissement du jeu de données</a>
  <ul class="collapse">
  <li><a href="#créer-un-géodataframe-des-mutations" id="toc-créer-un-géodataframe-des-mutations" class="nav-link" data-scroll-target="#créer-un-géodataframe-des-mutations">Créer un géodataframe des mutations</a></li>
  <li><a href="#enrichir-dinformations-sur-les-communes" id="toc-enrichir-dinformations-sur-les-communes" class="nav-link" data-scroll-target="#enrichir-dinformations-sur-les-communes">Enrichir d’informations sur les communes</a>
  <ul class="collapse">
  <li><a href="#importer-la-couche-des-communes-de-france-admin-express-ign-et-la-reprojeter" id="toc-importer-la-couche-des-communes-de-france-admin-express-ign-et-la-reprojeter" class="nav-link" data-scroll-target="#importer-la-couche-des-communes-de-france-admin-express-ign-et-la-reprojeter">Importer la couche des communes de France (Admin Express IGN) et la reprojeter</a></li>
  <li><a href="#ajouter-le-nom-et-le-code-insee-de-la-commune-et-le-nom-du-département-selon-le-dernier-cog" id="toc-ajouter-le-nom-et-le-code-insee-de-la-commune-et-le-nom-du-département-selon-le-dernier-cog" class="nav-link" data-scroll-target="#ajouter-le-nom-et-le-code-insee-de-la-commune-et-le-nom-du-département-selon-le-dernier-cog">Ajouter le nom et le code INSEE de la commune et le nom du département (selon le dernier COG)</a></li>
  <li><a href="#importer-le-dataset-des-départements" id="toc-importer-le-dataset-des-départements" class="nav-link" data-scroll-target="#importer-le-dataset-des-départements">Importer le dataset des départements</a></li>
  <li><a href="#faire-la-jointure-attributaire" id="toc-faire-la-jointure-attributaire" class="nav-link" data-scroll-target="#faire-la-jointure-attributaire">Faire la jointure attributaire</a></li>
  <li><a href="#importer-le-dataset-des-régions" id="toc-importer-le-dataset-des-régions" class="nav-link" data-scroll-target="#importer-le-dataset-des-régions">Importer le dataset des régions</a></li>
  <li><a href="#faire-la-jointure-attributaire-1" id="toc-faire-la-jointure-attributaire-1" class="nav-link" data-scroll-target="#faire-la-jointure-attributaire-1">Faire la jointure attributaire</a></li>
  <li><a href="#importer-le-dataset-de-la-typologie-de-linsee" id="toc-importer-le-dataset-de-la-typologie-de-linsee" class="nav-link" data-scroll-target="#importer-le-dataset-de-la-typologie-de-linsee">Importer le dataset de la typologie de l’INSEE</a></li>
  <li><a href="#faire-la-jointure-attributaire-2" id="toc-faire-la-jointure-attributaire-2" class="nav-link" data-scroll-target="#faire-la-jointure-attributaire-2">Faire la jointure attributaire</a></li>
  <li><a href="#importer-la-couche-des-epci-de-france-admin-express-ign-et-la-reprojeter" id="toc-importer-la-couche-des-epci-de-france-admin-express-ign-et-la-reprojeter" class="nav-link" data-scroll-target="#importer-la-couche-des-epci-de-france-admin-express-ign-et-la-reprojeter">Importer la couche des EPCI de France (Admin Express IGN) et la reprojeter</a></li>
  <li><a href="#ajouter-le-nom-le-code-et-le-type-des-epci-aux-mutations" id="toc-ajouter-le-nom-le-code-et-le-type-des-epci-aux-mutations" class="nav-link" data-scroll-target="#ajouter-le-nom-le-code-et-le-type-des-epci-aux-mutations">Ajouter le nom, le code et le type des EPCI aux mutations</a></li>
  <li><a href="#filtre-possible-selon-le-prix-au-m2-et-la-nature-de-lepci" id="toc-filtre-possible-selon-le-prix-au-m2-et-la-nature-de-lepci" class="nav-link" data-scroll-target="#filtre-possible-selon-le-prix-au-m2-et-la-nature-de-lepci">Filtre possible selon le prix au m2 et la nature de l’EPCI</a></li>
  </ul></li>
  <li><a href="#restructurer-le-jeu-de-données" id="toc-restructurer-le-jeu-de-données" class="nav-link" data-scroll-target="#restructurer-le-jeu-de-données">Restructurer le jeu de données</a>
  <ul class="collapse">
  <li><a href="#ecrire-le-jeu-de-données-final-en-csv" id="toc-ecrire-le-jeu-de-données-final-en-csv" class="nav-link" data-scroll-target="#ecrire-le-jeu-de-données-final-en-csv">Ecrire le jeu de données final en csv</a></li>
  <li><a href="#ecrire-le-jeu-de-données-final-en-gpkg" id="toc-ecrire-le-jeu-de-données-final-en-gpkg" class="nav-link" data-scroll-target="#ecrire-le-jeu-de-données-final-en-gpkg">Ecrire le jeu de données final en GPKG</a></li>
  <li><a href="#fusionner-plusieurs-dataframe-pour-travailler-sur-plusieurs-années" id="toc-fusionner-plusieurs-dataframe-pour-travailler-sur-plusieurs-années" class="nav-link" data-scroll-target="#fusionner-plusieurs-dataframe-pour-travailler-sur-plusieurs-années">Fusionner plusieurs dataframe pour travailler sur plusieurs années</a></li>
  <li><a href="#charger-le-dataset-finalisé" id="toc-charger-le-dataset-finalisé" class="nav-link" data-scroll-target="#charger-le-dataset-finalisé">Charger le dataset finalisé</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#explorations-graphiques" id="toc-explorations-graphiques" class="nav-link" data-scroll-target="#explorations-graphiques">Explorations graphiques</a>
  <ul class="collapse">
  <li><a href="#analyses-à-léchelle-des-communes" id="toc-analyses-à-léchelle-des-communes" class="nav-link" data-scroll-target="#analyses-à-léchelle-des-communes">Analyses à l’échelle des communes</a>
  <ul class="collapse">
  <li><a href="#récapitulatif-communes" id="toc-récapitulatif-communes" class="nav-link" data-scroll-target="#récapitulatif-communes">Récapitulatif communes</a></li>
  <li><a href="#récapitulatif-typologie-insee" id="toc-récapitulatif-typologie-insee" class="nav-link" data-scroll-target="#récapitulatif-typologie-insee">Récapitulatif typologie INSEE</a></li>
  <li><a href="#importer-la-base-comparateur-de-linsee" id="toc-importer-la-base-comparateur-de-linsee" class="nav-link" data-scroll-target="#importer-la-base-comparateur-de-linsee">Importer la base comparateur de l’INSEE</a></li>
  <li><a href="#enrichir-la-table-des-communes-avec-des-variables-de-linsee" id="toc-enrichir-la-table-des-communes-avec-des-variables-de-linsee" class="nav-link" data-scroll-target="#enrichir-la-table-des-communes-avec-des-variables-de-linsee">Enrichir la table des communes avec des variables de l’INSEE</a></li>
  <li><a href="#scatterplot-revenusprix" id="toc-scatterplot-revenusprix" class="nav-link" data-scroll-target="#scatterplot-revenusprix">Scatterplot Revenus/prix</a></li>
  <li><a href="#calcul-de-labordabilité" id="toc-calcul-de-labordabilité" class="nav-link" data-scroll-target="#calcul-de-labordabilité">Calcul de l’abordabilité</a></li>
  <li><a href="#graphiques-des-prix-au-m2-par-typologie-insee" id="toc-graphiques-des-prix-au-m2-par-typologie-insee" class="nav-link" data-scroll-target="#graphiques-des-prix-au-m2-par-typologie-insee">Graphiques des prix au m2 par typologie INSEE</a></li>
  <li><a href="#graphiques-des-surfaces-par-typologie-insee" id="toc-graphiques-des-surfaces-par-typologie-insee" class="nav-link" data-scroll-target="#graphiques-des-surfaces-par-typologie-insee">Graphiques des surfaces par typologie INSEE</a></li>
  <li><a href="#graphiques-sur-toutes-les-mutations" id="toc-graphiques-sur-toutes-les-mutations" class="nav-link" data-scroll-target="#graphiques-sur-toutes-les-mutations">Graphiques sur toutes les mutations</a></li>
  </ul></li>
  <li><a href="#analyses-à-léchelle-des-epci" id="toc-analyses-à-léchelle-des-epci" class="nav-link" data-scroll-target="#analyses-à-léchelle-des-epci">Analyses à l’échelle des EPCI</a>
  <ul class="collapse">
  <li><a href="#récapitulatif-epci" id="toc-récapitulatif-epci" class="nav-link" data-scroll-target="#récapitulatif-epci">Récapitulatif EPCI</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#cartographie-exploratoire" id="toc-cartographie-exploratoire" class="nav-link" data-scroll-target="#cartographie-exploratoire">Cartographie exploratoire</a>
  <ul class="collapse">
  <li><a href="#ajout-des-couches-géographiques" id="toc-ajout-des-couches-géographiques" class="nav-link" data-scroll-target="#ajout-des-couches-géographiques">Ajout des couches géographiques</a></li>
  <li><a href="#cartographie-à-léchelle-des-communes" id="toc-cartographie-à-léchelle-des-communes" class="nav-link" data-scroll-target="#cartographie-à-léchelle-des-communes">Cartographie à l’échelle des communes</a>
  <ul class="collapse">
  <li><a href="#jointure-attributaire-entre-récapitulatif-des-communes-et-la-couche-communes" id="toc-jointure-attributaire-entre-récapitulatif-des-communes-et-la-couche-communes" class="nav-link" data-scroll-target="#jointure-attributaire-entre-récapitulatif-des-communes-et-la-couche-communes">Jointure attributaire entre récapitulatif des communes et la couche communes</a></li>
  <li><a href="#cartographie-des-prix-moyens-par-commune" id="toc-cartographie-des-prix-moyens-par-commune" class="nav-link" data-scroll-target="#cartographie-des-prix-moyens-par-commune">Cartographie des prix moyens par commune</a></li>
  <li><a href="#cartographie-des-prix-moyens-au-m2" id="toc-cartographie-des-prix-moyens-au-m2" class="nav-link" data-scroll-target="#cartographie-des-prix-moyens-au-m2">Cartographie des prix moyens au m2</a></li>
  <li><a href="#cartographie-de-labordabilité" id="toc-cartographie-de-labordabilité" class="nav-link" data-scroll-target="#cartographie-de-labordabilité">Cartographie de l’abordabilité</a></li>
  <li><a href="#histrogramme-de-distribution-de-la-variable" id="toc-histrogramme-de-distribution-de-la-variable" class="nav-link" data-scroll-target="#histrogramme-de-distribution-de-la-variable">Histrogramme de distribution de la variable</a></li>
  </ul></li>
  <li><a href="#cartographie-à-léchelle-des-epci" id="toc-cartographie-à-léchelle-des-epci" class="nav-link" data-scroll-target="#cartographie-à-léchelle-des-epci">Cartographie à l’échelle des EPCI</a>
  <ul class="collapse">
  <li><a href="#jointure-attributaire-entre-récapitulatif-des-epci-et-la-couche-epci" id="toc-jointure-attributaire-entre-récapitulatif-des-epci-et-la-couche-epci" class="nav-link" data-scroll-target="#jointure-attributaire-entre-récapitulatif-des-epci-et-la-couche-epci">Jointure attributaire entre récapitulatif des EPCI et la couche EPCI</a></li>
  <li><a href="#cartographie-du-volume-de-mutations-par-epci" id="toc-cartographie-du-volume-de-mutations-par-epci" class="nav-link" data-scroll-target="#cartographie-du-volume-de-mutations-par-epci">Cartographie du volume de mutations par EPCI</a></li>
  <li><a href="#cartographie-du-volume-de-maisons-et-prix-moyen-au-m2" id="toc-cartographie-du-volume-de-maisons-et-prix-moyen-au-m2" class="nav-link" data-scroll-target="#cartographie-du-volume-de-maisons-et-prix-moyen-au-m2">Cartographie du volume de maisons et prix moyen au m2</a></li>
  <li><a href="#cartographie-du-volume-dappartements-vendus-et-prix-moyen-au-m2" id="toc-cartographie-du-volume-dappartements-vendus-et-prix-moyen-au-m2" class="nav-link" data-scroll-target="#cartographie-du-volume-dappartements-vendus-et-prix-moyen-au-m2">Cartographie du volume d’appartements vendus et prix moyen au m2</a></li>
  <li><a href="#cartographie-des-prix-moyens-par-epci" id="toc-cartographie-des-prix-moyens-par-epci" class="nav-link" data-scroll-target="#cartographie-des-prix-moyens-par-epci">Cartographie des prix moyens par EPCI</a></li>
  <li><a href="#cartographie-des-prix-moyens-au-m2-par-epci" id="toc-cartographie-des-prix-moyens-au-m2-par-epci" class="nav-link" data-scroll-target="#cartographie-des-prix-moyens-au-m2-par-epci">Cartographie des prix moyens au m2 par EPCI</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#analyse-spatiale" id="toc-analyse-spatiale" class="nav-link" data-scroll-target="#analyse-spatiale">Analyse spatiale</a>
  <ul class="collapse">
  <li><a href="#dataset-spatial-des-mutations" id="toc-dataset-spatial-des-mutations" class="nav-link" data-scroll-target="#dataset-spatial-des-mutations">Dataset spatial des mutations</a></li>
  <li><a href="#analyses-par-carroyages" id="toc-analyses-par-carroyages" class="nav-link" data-scroll-target="#analyses-par-carroyages">Analyses par carroyages</a>
  <ul class="collapse">
  <li><a href="#créer-une-grille-avec-des-mailles-de-5km" id="toc-créer-une-grille-avec-des-mailles-de-5km" class="nav-link" data-scroll-target="#créer-une-grille-avec-des-mailles-de-5km">Créer une grille avec des mailles de 5km</a></li>
  <li><a href="#agrégation-spatiale-sur-le-carroyage-compte-prix-et-prix-au-m2" id="toc-agrégation-spatiale-sur-le-carroyage-compte-prix-et-prix-au-m2" class="nav-link" data-scroll-target="#agrégation-spatiale-sur-le-carroyage-compte-prix-et-prix-au-m2">Agrégation spatiale sur le carroyage (compte, prix et prix au m2)</a></li>
  <li><a href="#ecrire-le-jeu-de-données-en-gpkg-pour-un-usage-dans-un-logiciel-sig-chargement-du-dataset" id="toc-ecrire-le-jeu-de-données-en-gpkg-pour-un-usage-dans-un-logiciel-sig-chargement-du-dataset" class="nav-link" data-scroll-target="#ecrire-le-jeu-de-données-en-gpkg-pour-un-usage-dans-un-logiciel-sig-chargement-du-dataset">Ecrire le jeu de données en GPKG pour un usage dans un logiciel SIG / Chargement du dataset</a></li>
  <li><a href="#cartographie-des-prix-moyens-au-m2-1" id="toc-cartographie-des-prix-moyens-au-m2-1" class="nav-link" data-scroll-target="#cartographie-des-prix-moyens-au-m2-1">Cartographie des prix moyens au m2</a></li>
  <li><a href="#cartographie-des-prix-moyens" id="toc-cartographie-des-prix-moyens" class="nav-link" data-scroll-target="#cartographie-des-prix-moyens">Cartographie des prix moyens</a></li>
  </ul></li>
  <li><a href="#lissage-spatial-à-partir-des-prix-moyen-des-communes" id="toc-lissage-spatial-à-partir-des-prix-moyen-des-communes" class="nav-link" data-scroll-target="#lissage-spatial-à-partir-des-prix-moyen-des-communes">Lissage spatial à partir des prix moyen des communes</a>
  <ul class="collapse">
  <li><a href="#création-du-jeux-de-données-centroides-des-communes" id="toc-création-du-jeux-de-données-centroides-des-communes" class="nav-link" data-scroll-target="#création-du-jeux-de-données-centroides-des-communes">Création du jeux de données (centroides des communes)</a></li>
  <li><a href="#calcul-des-paramètres-du-lissage" id="toc-calcul-des-paramètres-du-lissage" class="nav-link" data-scroll-target="#calcul-des-paramètres-du-lissage">Calcul des paramètres du lissage</a></li>
  <li><a href="#lissage-spatial" id="toc-lissage-spatial" class="nav-link" data-scroll-target="#lissage-spatial">Lissage spatial</a></li>
  <li><a href="#cartographie-du-lissage-spatial" id="toc-cartographie-du-lissage-spatial" class="nav-link" data-scroll-target="#cartographie-du-lissage-spatial">Cartographie du lissage spatial</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#analyse-statistique" id="toc-analyse-statistique" class="nav-link" data-scroll-target="#analyse-statistique">Analyse statistique</a>
  <ul class="collapse">
  <li><a href="#segmentation-des-sous-marchés-immobiliers-à-léchelle-des-epci-par-cah" id="toc-segmentation-des-sous-marchés-immobiliers-à-léchelle-des-epci-par-cah" class="nav-link" data-scroll-target="#segmentation-des-sous-marchés-immobiliers-à-léchelle-des-epci-par-cah">Segmentation des sous-marchés immobiliers à l’échelle des EPCI par CAH</a>
  <ul class="collapse">
  <li><a href="#préparation-du-jeu-de-données-1" id="toc-préparation-du-jeu-de-données-1" class="nav-link" data-scroll-target="#préparation-du-jeu-de-données-1">Préparation du jeu de données</a></li>
  <li><a href="#variables-centrées-réduites" id="toc-variables-centrées-réduites" class="nav-link" data-scroll-target="#variables-centrées-réduites">Variables centrées-réduites</a></li>
  <li><a href="#réaliser-lacp" id="toc-réaliser-lacp" class="nav-link" data-scroll-target="#réaliser-lacp">Réaliser l’ACP</a></li>
  <li><a href="#réalisez-une-cah-sur-les-composantes-principales-cp" id="toc-réalisez-une-cah-sur-les-composantes-principales-cp" class="nav-link" data-scroll-target="#réalisez-une-cah-sur-les-composantes-principales-cp">Réalisez une CAH sur les composantes principales (CP)</a></li>
  <li><a href="#tableau-reapitulatif-des-groupes" id="toc-tableau-reapitulatif-des-groupes" class="nav-link" data-scroll-target="#tableau-reapitulatif-des-groupes">Tableau reapitulatif des groupes</a></li>
  <li><a href="#graphique-de-variations-à-la-moyenne" id="toc-graphique-de-variations-à-la-moyenne" class="nav-link" data-scroll-target="#graphique-de-variations-à-la-moyenne">Graphique de variations à la moyenne</a></li>
  <li><a href="#cartographie-de-la-cah" id="toc-cartographie-de-la-cah" class="nav-link" data-scroll-target="#cartographie-de-la-cah">Cartographie de la CAH</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">DVF_France</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>B. Mericskay et F. Demoraes </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 1, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="emplacement-du-projet" class="level3">
<h3 class="anchored" data-anchor-id="emplacement-du-projet">Emplacement du projet</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">'C:/Users/mericskay_b/Desktop/R/DVF'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="packages-nécessaires" class="level3">
<h3 class="anchored" data-anchor-id="packages-nécessaires">Packages nécessaires</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># Pour la préparation de données</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># Pour l'analyse spatiale</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf) <span class="co"># Pour la cartographie thématique</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cartography) <span class="co"># Pour la cartographie</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR) <span class="co"># Pour l'analyse statistique</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)  <span class="co"># Pour l'analyse statistique</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep) <span class="co"># pour calculer l'auto-corrélation spatiale</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR) <span class="co"># pour calculer le semi-variogramme empirique</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat) <span class="co"># pour produire des surfaces lissées</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra) <span class="co"># pour le traitement de données matricielles (raster)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analyser-les-données-dvf-à-léchelle-de-la-france" class="level1">
<h1>Analyser les données DVF à l’échelle de la France</h1>
<p><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTdPZNJsoIMKT5ahXo23LYi3dlgsV2TqJSFDg&amp;usqp=CAU.png" class="img-fluid" style="float:right;" alt="Illustration of three species of Palmer Archipelago penguins: Chinstrap, Gentoo, and Adelie. Artwork by @allison_horst."></p>
<p>Longtemps stockées dans différentes bases complexes et peu accessibles, les données concernant les transactions foncières et immobilières sont aujourd’hui plus facilement disponibles depuis l’ouverture en 2019 de la base “<strong>Demandes de valeurs foncières</strong>” (DVF).</p>
<p>Toutefois, l’utilisation de ces données à des fins analytiques nécessite un travail de préparation important qu’il ne faut pas sous-estimer. Ce notebook (fait avec Quarto) présente une chaîne de traitements dédiée à la préparation des données DVF en <em>open data</em> formalisée dans l’environnement R et documentée dans un souci de reproductibilité.</p>
<ul>
<li><p><strong>Préparation des données</strong></p></li>
<li><p><strong>Enrichissement des données</strong></p></li>
<li><p><strong>Exploration graphique</strong></p></li>
<li><p><strong>Cartographie exploratoire</strong></p></li>
<li><p><strong>Analyse spatiale</strong></p></li>
<li><p><strong>Analyse statistique</strong></p></li>
</ul>
</section>
<section id="préparation-du-jeu-de-données" class="level1">
<h1>Préparation du jeu de données</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://journals.openedition.org/cybergeo/docannexe/image/39583/img-1.png" class="img-fluid figure-img" width="532"></p>
</figure>
</div>
<section id="téléchargement-et-chargement-du-jeu-de-données-dans-r" class="level3">
<h3 class="anchored" data-anchor-id="téléchargement-et-chargement-du-jeu-de-données-dans-r">Téléchargement et chargement du jeu de données dans R</h3>
<p>Le jeu de données utilisé est celui des <strong>Demandes de valeurs foncières géolocalisées</strong> produit par Etalab. Ce dataset est disponible par année, à l’échelle de la France ou des départements sur le plateforme de données ouvertr data.gouv.fr.</p>
<p><strong>Page Data.gouv</strong> : <a href="https://www.data.gouv.fr/fr/datasets/demandes-de-valeurs-foncieres-geolocalisees/" class="uri">https://www.data.gouv.fr/fr/datasets/demandes-de-valeurs-foncieres-geolocalisees/</a></p>
</section>
<section id="filtre-et-nettoyage-des-données" class="level3">
<h3 class="anchored" data-anchor-id="filtre-et-nettoyage-des-données">Filtre et nettoyage des données</h3>
<section id="etape1-sélection-des-mutations-de-type-ventes-de-maison-et-appartement" class="level4">
<h4 class="anchored" data-anchor-id="etape1-sélection-des-mutations-de-type-ventes-de-maison-et-appartement">Etape1&gt; Sélection des mutations de type “Ventes” de “Maison” et “Appartement”</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>etape1 <span class="ot">&lt;-</span> DVF <span class="sc">%&gt;%</span> <span class="fu">filter</span>(nature_mutation <span class="sc">==</span> <span class="st">"Vente"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>etape1bis <span class="ot">&lt;-</span> etape1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type_local <span class="sc">==</span> <span class="st">"Maison"</span> <span class="sc">|</span> type_local <span class="sc">==</span> <span class="st">"Appartement"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="etape2-sélection-et-renommage-des-variables" class="level4">
<h4 class="anchored" data-anchor-id="etape2-sélection-et-renommage-des-variables">Etape2&gt; Sélection et renommage des variables</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>etape2 <span class="ot">&lt;-</span> etape1bis <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">id =</span> id_mutation, <span class="at">disposition =</span> numero_disposition, <span class="at">parcelle=</span> id_parcelle, <span class="at">date =</span> date_mutation, <span class="at">nature =</span> nature_mutation, <span class="at">codecommune =</span> code_commune, <span class="at">departement =</span> code_departement, <span class="at">type =</span> type_local, <span class="at">surface =</span> surface_reelle_bati, <span class="at">pieces =</span> nombre_pieces_principales, <span class="at">prix =</span> valeur_fonciere, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="etape3-remplacement-des-cellules-vides-par-des-na-et-suppression-des-na" class="level4">
<h4 class="anchored" data-anchor-id="etape3-remplacement-des-cellules-vides-par-des-na-et-suppression-des-na">Etape3&gt; Remplacement des cellules vides par des NA et suppression des NA</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>etape2[etape2<span class="sc">==</span><span class="st">""</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>etape3 <span class="ot">&lt;-</span> etape2 <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="suppression-des-doublons-et-des-mutations-multiventes" class="level3">
<h3 class="anchored" data-anchor-id="suppression-des-doublons-et-des-mutations-multiventes">Suppression des doublons et des mutations multiventes</h3>
<section id="etape4-suppression-des-doublons-et-des-mutations-multiventes" class="level4">
<h4 class="anchored" data-anchor-id="etape4-suppression-des-doublons-et-des-mutations-multiventes">Etape4&gt; Suppression des doublons et des mutations multiventes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>unique <span class="ot">&lt;-</span> etape3 <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(id, prix, surface)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>nbunique <span class="ot">&lt;-</span> unique <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">n</span>())</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>etape4 <span class="ot">&lt;-</span> nbunique <span class="sc">%&gt;%</span> <span class="fu">filter</span>(nb<span class="sc">==</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="etape5-jointure-attributaire-pour-récupérer-les-informations-des-mutations" class="level4">
<h4 class="anchored" data-anchor-id="etape5-jointure-attributaire-pour-récupérer-les-informations-des-mutations">Etape5&gt; Jointure attributaire pour récupérer les informations des mutations</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>merge <span class="ot">&lt;-</span> <span class="fu">merge</span>(etape4,etape3, <span class="at">by=</span><span class="st">"id"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>etape5 <span class="ot">&lt;-</span> merge <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, date, type, nature, codecommune, prix, surface, pieces, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modification-des-formats-des-colonnes" class="level4">
<h4 class="anchored" data-anchor-id="modification-des-formats-des-colonnes">Modification des formats des colonnes</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>etape5<span class="sc">$</span>prix <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(etape5<span class="sc">$</span>prix)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>etape5<span class="sc">$</span>surface <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(etape5<span class="sc">$</span>surface)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>etape5<span class="sc">$</span>piece <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(etape5<span class="sc">$</span>piece)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="suppression-des-valeurs-aberrantes" class="level3">
<h3 class="anchored" data-anchor-id="suppression-des-valeurs-aberrantes">Suppression des valeurs aberrantes</h3>
<section id="fixer-un-seuil-minimal-des-prix-méthode-des-percentiles" class="level4">
<h4 class="anchored" data-anchor-id="fixer-un-seuil-minimal-des-prix-méthode-des-percentiles">Fixer un seuil minimal des prix (méthode des percentiles)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(etape5<span class="sc">$</span>prix, <span class="fl">0.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   1% 
18000 </code></pre>
</div>
</div>
</section>
<section id="fixer-un-seuil-maximal-des-prix-identification-par-un-histogramme" class="level4">
<h4 class="anchored" data-anchor-id="fixer-un-seuil-maximal-des-prix-identification-par-un-histogramme">Fixer un seuil maximal des prix (identification par un histogramme)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(etape5<span class="sc">$</span>prix, <span class="at">breaks =</span> <span class="dv">100000</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="créer-deux-jeux-de-données-maisons-appartements" class="level4">
<h4 class="anchored" data-anchor-id="créer-deux-jeux-de-données-maisons-appartements">Créer deux jeux de données (maisons / appartements)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Maisons <span class="ot">&lt;-</span> etape5 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">'Maison'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Appartement <span class="ot">&lt;-</span> etape5 <span class="sc">%&gt;%</span> <span class="fu">filter</span> (type <span class="sc">==</span> <span class="st">'Appartement'</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fixer-un-seuil-maximal-des-surfaces-histogramme" class="level4">
<h4 class="anchored" data-anchor-id="fixer-un-seuil-maximal-des-surfaces-histogramme">Fixer un seuil maximal des surfaces (histogramme)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Maisons<span class="sc">$</span>surface, <span class="at">nclass =</span> <span class="dv">500</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">600</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Appartement<span class="sc">$</span>surface, <span class="at">nclass =</span> <span class="dv">500</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">300</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="etape-6-sélection-des-bornes-de-prix-et-de-surface" class="level4">
<h4 class="anchored" data-anchor-id="etape-6-sélection-des-bornes-de-prix-et-de-surface">Etape 6&gt; Sélection des bornes de prix et de surface</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>etape6 <span class="ot">&lt;-</span> etape5 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">between</span>(prix, <span class="dv">15000</span>, <span class="dv">10000000</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">filter</span>(<span class="fu">case_when</span>(type<span class="sc">==</span><span class="st">'Appartement'</span> <span class="sc">~</span>  <span class="fu">between</span>(surface, <span class="dv">10</span>, <span class="dv">250</span>)) <span class="sc">|</span>                     <span class="fu">case_when</span>(type<span class="sc">==</span><span class="st">'Maison'</span> <span class="sc">~</span>  <span class="fu">between</span>(surface, <span class="dv">10</span>, <span class="dv">400</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="création-de-la-variable-de-prix-au-m²-et-filtre-des-valeurs-extrêmes-et-aberrantes" class="level3">
<h3 class="anchored" data-anchor-id="création-de-la-variable-de-prix-au-m²-et-filtre-des-valeurs-extrêmes-et-aberrantes">Création de la variable de prix au m² et filtre des valeurs extrêmes et aberrantes</h3>
<section id="etape7-création-de-la-variable-prixm²" class="level4">
<h4 class="anchored" data-anchor-id="etape7-création-de-la-variable-prixm²">Etape7&gt; Création de la variable prix/m²</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>etape7 <span class="ot">&lt;-</span> etape6 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">prixm2 =</span> prix<span class="sc">/</span>surface)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="etape8-sélection-des-bornes-de-prix-au-m²" class="level4">
<h4 class="anchored" data-anchor-id="etape8-sélection-des-bornes-de-prix-au-m²">Etape8 &gt; Sélection des bornes de prix au m²</h4>
<section id="fixer-un-seuil-minimal-des-prix-au-m²-percentile" class="level5">
<h5 class="anchored" data-anchor-id="fixer-un-seuil-minimal-des-prix-au-m²-percentile">Fixer un seuil minimal des prix au m² (percentile)</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(etape7<span class="sc">$</span>prixm2, <span class="fl">0.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1% 
388.3495 </code></pre>
</div>
</div>
</section>
<section id="fixer-un-seuil-maximal-des-prix-au-m²-histogramme" class="level5">
<h5 class="anchored" data-anchor-id="fixer-un-seuil-maximal-des-prix-au-m²-histogramme">Fixer un seuil maximal des prix au m² (histogramme)</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(etape7<span class="sc">$</span>prixm2, <span class="at">breaks =</span> <span class="dv">2000</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">18000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="filtres-des-valeurs-des-prix-au-m2" class="level4">
<h4 class="anchored" data-anchor-id="filtres-des-valeurs-des-prix-au-m2">Filtres des valeurs des prix au m2</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>etape8 <span class="ot">&lt;-</span> etape7 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">between</span>(prixm2,<span class="dv">330</span>,<span class="dv">18000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transformation-de-la-date-en-année" class="level4">
<h4 class="anchored" data-anchor-id="transformation-de-la-date-en-année">Transformation de la date en année</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>etape8<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.character</span>(etape8<span class="sc">$</span>date)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>etape8 <span class="ot">&lt;-</span> etape8 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ANNEE =</span> <span class="fu">substr</span>(etape8<span class="sc">$</span>date, <span class="dv">1</span>, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="arrondir-les-variables-numériques" class="level4">
<h4 class="anchored" data-anchor-id="arrondir-les-variables-numériques">Arrondir les variables numériques</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>etape8<span class="sc">$</span>prix <span class="ot">&lt;-</span> <span class="fu">round</span>(etape8<span class="sc">$</span>prix)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>etape8<span class="sc">$</span>prixm2 <span class="ot">&lt;-</span> <span class="fu">round</span>(etape8<span class="sc">$</span>prixm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="enrichissement-du-jeu-de-données" class="level1">
<h1>Enrichissement du jeu de données</h1>
<p>La méthode de l’enrichissement des mutations par <strong>jointure spatiale</strong> permet de venir enrichir et agréger les mutations individuelles au sein du référentiel géographique de son choix (par exemple la couche des communes de l’année 2022). Une fois le code commune associé à chaque mutation comme <strong>donnée pivot</strong>, l’enrichissement se base sur des jointures attributaires.</p>
<p>L’objectif est de venir qualifier chaque mutation par une série d’informations sur :</p>
<ul>
<li><p>La <strong>région</strong> (code et nom)</p></li>
<li><p>Le <strong>département</strong> (code et nom)</p></li>
<li><p><strong>L’EPCI</strong> (code, nom et type)</p></li>
<li><p>La <strong>commune</strong> (code, nom et typologie)</p></li>
</ul>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/Enrichissement.png" class="img-fluid figure-img"></p>
</figure>
</div>
<section id="créer-un-géodataframe-des-mutations" class="level2">
<h2 class="anchored" data-anchor-id="créer-un-géodataframe-des-mutations">Créer un géodataframe des mutations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>etape8 <span class="ot">&lt;-</span> etape8 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">x=</span> longitude, <span class="at">y =</span> latitude )</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>DVFgeo<span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(etape8, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>), <span class="at">crs=</span><span class="dv">4326</span> ) </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>DVFgeo<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(DVFgeo, <span class="dv">2154</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="enrichir-dinformations-sur-les-communes" class="level2">
<h2 class="anchored" data-anchor-id="enrichir-dinformations-sur-les-communes">Enrichir d’informations sur les communes</h2>
<section id="importer-la-couche-des-communes-de-france-admin-express-ign-et-la-reprojeter" class="level3">
<h3 class="anchored" data-anchor-id="importer-la-couche-des-communes-de-france-admin-express-ign-et-la-reprojeter">Importer la couche des communes de France (Admin Express IGN) et la reprojeter</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Communes <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"E:/AdminExpress/CommunesFrance.shp"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `CommunesFrance' from data source 
  `E:\AdminExpress\CommunesFrance.shp' using driver `ESRI Shapefile'
Simple feature collection with 34816 features and 13 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 99040 ymin: 6046546 xmax: 1242440 ymax: 7110479
Projected CRS: RGF93 Lambert 93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ContourFrance <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"E:/AdminExpress/CONTOURS_FRANCE.shp"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `CONTOURS_FRANCE' from data source 
  `E:\AdminExpress\CONTOURS_FRANCE.shp' using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 99040 ymin: 6046546 xmax: 1242443 ymax: 7110479
Projected CRS: RGF93 Lambert 93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>Regions <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"E:/AdminExpress/REGION.shp"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `REGION' from data source `E:\AdminExpress\REGION.shp' using driver `ESRI Shapefile'
Simple feature collection with 13 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 99040 ymin: 6046546 xmax: 1242443 ymax: 7110479
Projected CRS: RGF93 Lambert 93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>Communes<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(Communes, <span class="dv">2154</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ContourFrance<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ContourFrance, <span class="dv">2154</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ajouter-le-nom-et-le-code-insee-de-la-commune-et-le-nom-du-département-selon-le-dernier-cog" class="level3">
<h3 class="anchored" data-anchor-id="ajouter-le-nom-et-le-code-insee-de-la-commune-et-le-nom-du-département-selon-le-dernier-cog">Ajouter le nom et le code INSEE de la commune et le nom du département (selon le dernier COG)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>DVFgeo <span class="ot">&lt;-</span> <span class="fu">st_join</span>(DVFgeo, Communes[<span class="fu">c</span>(<span class="st">"NOM"</span>, <span class="st">"INSEE_COM"</span>, <span class="st">"INSEE_DEP"</span>, <span class="st">"INSEE_REG"</span>)], <span class="at">left =</span> <span class="cn">TRUE</span>, <span class="at">.predicate =</span> within)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>DVFgeo <span class="ot">&lt;-</span> DVFgeo <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">NOM_COM=</span>NOM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importer-le-dataset-des-départements" class="level3">
<h3 class="anchored" data-anchor-id="importer-le-dataset-des-départements">Importer le dataset des départements</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.insee.fr/fr/statistiques/fichier/6800675/v_departement_2023.csv"</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>DEP <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url, <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="faire-la-jointure-attributaire" class="level3">
<h3 class="anchored" data-anchor-id="faire-la-jointure-attributaire">Faire la jointure attributaire</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>DVFgeodep <span class="ot">&lt;-</span> <span class="fu">merge</span>(DVFgeo, DEP, <span class="at">by.x =</span> <span class="st">"INSEE_DEP"</span>, <span class="at">by.y =</span> <span class="st">"DEP"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>DVFgeo <span class="ot">&lt;-</span> DVFgeodep[, <span class="fu">c</span>(<span class="fu">names</span>(DVFgeo), <span class="st">"NCC"</span>)] <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DEP=</span>NCC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importer-le-dataset-des-régions" class="level3">
<h3 class="anchored" data-anchor-id="importer-le-dataset-des-régions">Importer le dataset des régions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.insee.fr/fr/statistiques/fichier/6800675/v_region_2023.csv"</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>REGIONS <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url, <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="faire-la-jointure-attributaire-1" class="level3">
<h3 class="anchored" data-anchor-id="faire-la-jointure-attributaire-1">Faire la jointure attributaire</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>DVFgeoreg <span class="ot">&lt;-</span> <span class="fu">merge</span>(DVFgeo, REGIONS, <span class="at">by.x =</span> <span class="st">"INSEE_REG"</span>, <span class="at">by.y =</span> <span class="st">"REG"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>DVFgeo <span class="ot">&lt;-</span> DVFgeoreg[, <span class="fu">c</span>(<span class="fu">names</span>(DVFgeo), <span class="st">"NCC"</span>)] <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">REGION=</span>NCC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importer-le-dataset-de-la-typologie-de-linsee" class="level3">
<h3 class="anchored" data-anchor-id="importer-le-dataset-de-la-typologie-de-linsee">Importer le dataset de la typologie de l’INSEE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>TYPOINSEE <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"C:/Users/mericskay_b/Dropbox/DVF/TYPOINSEE.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="faire-la-jointure-attributaire-2" class="level3">
<h3 class="anchored" data-anchor-id="faire-la-jointure-attributaire-2">Faire la jointure attributaire</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>DVFgeotypo <span class="ot">&lt;-</span> <span class="fu">merge</span>(DVFgeo, TYPOINSEE, <span class="at">by.x =</span> <span class="st">"INSEE_COM"</span>, <span class="at">by.y =</span> <span class="st">"Code"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>DVFgeo <span class="ot">&lt;-</span> DVFgeotypo[, <span class="fu">c</span>(<span class="fu">names</span>(DVFgeo), <span class="st">"Typologie"</span>)] <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Typo_INSEE=</span>Typologie)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importer-la-couche-des-epci-de-france-admin-express-ign-et-la-reprojeter" class="level3">
<h3 class="anchored" data-anchor-id="importer-la-couche-des-epci-de-france-admin-express-ign-et-la-reprojeter">Importer la couche des EPCI de France (Admin Express IGN) et la reprojeter</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>EPCI <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"E:/AdminExpress/EPCI.shp"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `EPCI' from data source `E:\AdminExpress\EPCI.shp' using driver `ESRI Shapefile'
Simple feature collection with 1243 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 107388.8 ymin: 6046546 xmax: 1242443 ymax: 7110479
Projected CRS: RGF93 Lambert 93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>EPCI<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(EPCI, <span class="dv">2154</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ajouter-le-nom-le-code-et-le-type-des-epci-aux-mutations" class="level3">
<h3 class="anchored" data-anchor-id="ajouter-le-nom-le-code-et-le-type-des-epci-aux-mutations">Ajouter le nom, le code et le type des EPCI aux mutations</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>DVFgeo <span class="ot">&lt;-</span> <span class="fu">st_join</span>(DVFgeo, EPCI[<span class="fu">c</span>(<span class="st">"NOM"</span>, <span class="st">"NATURE"</span>, <span class="st">"CODE_SIREN"</span>)], <span class="at">left =</span> <span class="cn">TRUE</span>, <span class="at">.predicate =</span> within)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>DVFgeo <span class="ot">&lt;-</span> DVFgeo <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">EPCI_NOM=</span>NOM, <span class="at">EPCI_TYPE=</span>NATURE, <span class="at">EPCI_CODE=</span>CODE_SIREN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtre-possible-selon-le-prix-au-m2-et-la-nature-de-lepci" class="level3">
<h3 class="anchored" data-anchor-id="filtre-possible-selon-le-prix-au-m2-et-la-nature-de-lepci">Filtre possible selon le prix au m2 et la nature de l’EPCI</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Abberations <span class="ot">&lt;-</span> DVFgeo <span class="sc">%&gt;%</span> <span class="fu">filter</span>((EPCI_TYPE <span class="sc">==</span> <span class="st">"Communauté de communes"</span>) <span class="sc">&amp;</span> prixm2 <span class="sc">&gt;</span> <span class="dv">10000</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Abberations[<span class="st">"prix"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="restructurer-le-jeu-de-données" class="level2">
<h2 class="anchored" data-anchor-id="restructurer-le-jeu-de-données">Restructurer le jeu de données</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>MutationsDVF <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(DVFgeo)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>MutationsDVF <span class="ot">&lt;-</span> MutationsDVF <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, date, <span class="at">annee=</span> ANNEE, <span class="at">code_com =</span>INSEE_COM, <span class="at">nom_com =</span> NOM_COM, <span class="at">typo_insee =</span> Typo_INSEE, <span class="at">code_dep =</span> INSEE_DEP, <span class="at">nom_dep =</span> DEP, <span class="at">nom_region =</span> REGION, <span class="at">code_EPCI=</span>EPCI_CODE, <span class="at">nom_EPCI =</span> EPCI_NOM, <span class="at">type_EPCI =</span> EPCI_TYPE, type, prix, prixm2, surface, pieces, latitude, longitude)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">"MutationsDVF"</span>, <span class="st">"Communes"</span>, <span class="st">"EPCI"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="ecrire-le-jeu-de-données-final-en-csv" class="level3">
<h3 class="anchored" data-anchor-id="ecrire-le-jeu-de-données-final-en-csv">Ecrire le jeu de données final en csv</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#write.csv(MutationsDVF, 'DVF2017.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ecrire-le-jeu-de-données-final-en-gpkg" class="level3">
<h3 class="anchored" data-anchor-id="ecrire-le-jeu-de-données-final-en-gpkg">Ecrire le jeu de données final en GPKG</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## st_write(MutationsDVF, "DVF2022.gpkg")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fusionner-plusieurs-dataframe-pour-travailler-sur-plusieurs-années" class="level3">
<h3 class="anchored" data-anchor-id="fusionner-plusieurs-dataframe-pour-travailler-sur-plusieurs-années">Fusionner plusieurs dataframe pour travailler sur plusieurs années</h3>
<div class="cell">
<pre class="dvf2014 cell-code"><code>DVF2015 &lt;- read.csv("C:/Users/mericskay_b/Desktop/DVFFrance/DVF2015.csv")
DVF2016 &lt;- read.csv("C:/Users/mericskay_b/Desktop/DVFFrance/DVF2016.csv")
DVF2017 &lt;- read.csv("C:/Users/mericskay_b/Desktop/DVFFrance/DVF2017.csv")
DVF2018 &lt;- read.csv("C:/Users/mericskay_b/Desktop/DVFFrance/DVF2018.csv")
DVF2019 &lt;- read.csv("C:/Users/mericskay_b/Desktop/DVFFrance/DVF2019.csv")
DVF2020 &lt;- read.csv("C:/Users/mericskay_b/Desktop/DVFFrance/DVF2020.csv")
DVF2021 &lt;- read.csv("C:/Users/mericskay_b/Desktop/DVFFrance/DVF2021.csv")
DVF2022 &lt;- read.csv("C:/Users/mericskay_b/Desktop/DVFFrance/DVF2022.csv")

MutationsDVF &lt;- rbind(DVF2018, DVF2019, DVF2020, DVF2021, DVF2022)

# DVF &lt;- DVF %&gt;% select(prix, prixm2, latitude, longitude, typo_insee)

MutationsDVF$prix &lt;- as.integer(MutationsDVF$prix)

rm(list=setdiff(ls(), c("MutationsDVF")))</code></pre>
</div>
</section>
<section id="charger-le-dataset-finalisé" class="level3">
<h3 class="anchored" data-anchor-id="charger-le-dataset-finalisé">Charger le dataset finalisé</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#MutationsDVF &lt;- read_csv("C:/Users/mericskay_b/Desktop/R/DVF/MutationsDVF.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="explorations-graphiques" class="level1">
<h1>Explorations graphiques</h1>
<section id="analyses-à-léchelle-des-communes" class="level2">
<h2 class="anchored" data-anchor-id="analyses-à-léchelle-des-communes">Analyses à l’échelle des communes</h2>
<section id="récapitulatif-communes" class="level3">
<h3 class="anchored" data-anchor-id="récapitulatif-communes">Récapitulatif communes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>CommunesDVF <span class="ot">&lt;-</span> MutationsDVF <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code_com, typo_insee) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb =</span> <span class="fu">n</span>(),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">prix =</span> <span class="fu">mean</span>(prix),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prixM2 =</span> <span class="fu">mean</span>(prixm2),</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">nbmaisons =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Maison"</span>),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">nbapparts =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Appartement"</span>),</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">propmaison =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Maison"</span>)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">propappart =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Appartement"</span>)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">surface =</span> <span class="fu">mean</span>(surface)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'code_com'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
</section>
<section id="récapitulatif-typologie-insee" class="level3">
<h3 class="anchored" data-anchor-id="récapitulatif-typologie-insee">Récapitulatif typologie INSEE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>DVFdf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(MutationsDVF)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>TypoINSEEDVF <span class="ot">&lt;-</span> MutationsDVF <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(typo_insee) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb =</span> <span class="fu">n</span>(),</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prix =</span> <span class="fu">mean</span>(prix),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prixM2 =</span> <span class="fu">mean</span>(prixm2),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">nbmaisons =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Maison"</span>),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">nbapparts =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Appartement"</span>),</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">propmaison =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Maison"</span>)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">propappart =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Appartement"</span>)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">surface =</span> <span class="fu">mean</span>(surface)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importer-la-base-comparateur-de-linsee" class="level3">
<h3 class="anchored" data-anchor-id="importer-la-base-comparateur-de-linsee">Importer la base comparateur de l’INSEE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>baseCCINSEE <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"C:/Users/mericskay_b/Desktop/R/DVF/baseCCINSEE.csv"</span>, <span class="at">sep=</span><span class="st">";"</span>) </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>baseCCINSEE <span class="ot">&lt;-</span> baseCCINSEE <span class="sc">%&gt;%</span> <span class="fu">select</span>(CODGEO, MED20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="enrichir-la-table-des-communes-avec-des-variables-de-linsee" class="level3">
<h3 class="anchored" data-anchor-id="enrichir-la-table-des-communes-avec-des-variables-de-linsee">Enrichir la table des communes avec des variables de l’INSEE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>CommunesDVF <span class="ot">&lt;-</span> <span class="fu">merge</span>(CommunesDVF, baseCCINSEE, <span class="at">by.x =</span> <span class="st">"code_com"</span>, <span class="at">by.y =</span> <span class="st">"CODGEO"</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>CommunesDVF <span class="ot">&lt;-</span> CommunesDVF <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">revenu=</span>MED20)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>CommunesDVF<span class="sc">$</span>revenu <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(CommunesDVF<span class="sc">$</span>revenu )</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>CommunesDVF <span class="ot">&lt;-</span>CommunesDVF <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scatterplot-revenusprix" class="level3">
<h3 class="anchored" data-anchor-id="scatterplot-revenusprix">Scatterplot Revenus/prix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(CommunesDVF, <span class="fu">aes</span>(<span class="at">x =</span> revenu, <span class="at">y =</span> prix, <span class="at">size =</span> nb, <span class="at">color =</span> typo_insee)) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>  </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Scatterplot Revenu vs Prix"</span>,<span class="at">x =</span> <span class="st">"Revenu"</span>, <span class="at">y =</span> <span class="st">"Prix"</span>) <span class="sc">+</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(CommunesDVF<span class="sc">$</span>revenu), <span class="fu">max</span>(CommunesDVF<span class="sc">$</span>revenu), <span class="at">length.out =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="calcul-de-labordabilité" class="level3">
<h3 class="anchored" data-anchor-id="calcul-de-labordabilité">Calcul de l’abordabilité</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>CommunesDVF <span class="ot">&lt;-</span> CommunesDVF <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">affordabilite =</span> prixM2<span class="sc">/</span>(revenu<span class="sc">/</span><span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graphiques-des-prix-au-m2-par-typologie-insee" class="level3">
<h3 class="anchored" data-anchor-id="graphiques-des-prix-au-m2-par-typologie-insee">Graphiques des prix au m2 par typologie INSEE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(CommunesDVF, <span class="fu">aes</span>(<span class="at">x =</span> prixM2, <span class="at">fill =</span> typo_insee)) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">100</span>) <span class="sc">+</span>  <span class="co"># Réglez la largeur des barres d'histogramme</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> typo_insee, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span>  <span class="co"># Small multiples par NATURE</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogramme des prix par mètre carré par type de commune"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Prix par mètre carré"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Fréquence"</span>) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="graphiques-des-surfaces-par-typologie-insee" class="level3">
<h3 class="anchored" data-anchor-id="graphiques-des-surfaces-par-typologie-insee">Graphiques des surfaces par typologie INSEE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(MutationsDVF, <span class="fu">aes</span>(<span class="at">x =</span> surface, <span class="at">fill =</span> typo_insee)) <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span>  <span class="co"># Réglez la largeur des barres d'histogramme</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> typo_insee, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span>  <span class="co"># Small multiples par NATURE</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogramme des surfaces par type de commune"</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Prix par mètre carré"</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Fréquence"</span>) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="graphiques-sur-toutes-les-mutations" class="level3">
<h3 class="anchored" data-anchor-id="graphiques-sur-toutes-les-mutations">Graphiques sur toutes les mutations</h3>
<section id="filtres-pour-les-rendus-graphiques" class="level4">
<h4 class="anchored" data-anchor-id="filtres-pour-les-rendus-graphiques">Filtres pour les rendus graphiques</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>MutationsDVFSM <span class="ot">&lt;-</span> MutationsDVF <span class="sc">%&gt;%</span> <span class="fu">filter</span>(prix<span class="sc">&lt;</span><span class="dv">1000000</span>, prixm2<span class="sc">&lt;</span><span class="dv">10000</span>, surface<span class="sc">&lt;</span><span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prix-type-de-bien-et-type-de-commune" class="level4">
<h4 class="anchored" data-anchor-id="prix-type-de-bien-et-type-de-commune">Prix, type de bien et type de commune</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(MutationsDVFSM, <span class="fu">aes</span>(<span class="at">x =</span> prix, <span class="at">fill =</span> typo_insee)) <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10000</span>) <span class="sc">+</span>  </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(typo_insee <span class="sc">~</span> type) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogramme des prix par mètre carré par NATURE"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Prix par mètre carré"</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Fréquence"</span>) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="prix-au-m2-type-de-bien-et-type-de-commune" class="level4">
<h4 class="anchored" data-anchor-id="prix-au-m2-type-de-bien-et-type-de-commune">Prix au m2, type de bien et type de commune</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(MutationsDVFSM, <span class="fu">aes</span>(<span class="at">x =</span> prix, <span class="at">fill =</span> typo_insee)) <span class="sc">+</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10000</span>) <span class="sc">+</span>  </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(type <span class="sc">~</span> typo_insee) <span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogramme des prix par mètre carré par type de commune"</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Prix par mètre carré"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Fréquence"</span>) <span class="sc">+</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="surfaces-type-de-bien-et-type-de-commune" class="level4">
<h4 class="anchored" data-anchor-id="surfaces-type-de-bien-et-type-de-commune">Surfaces, type de bien et type de commune</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(MutationsDVFSM, <span class="fu">aes</span>(<span class="at">x =</span> surface, <span class="at">fill =</span> typo_insee)) <span class="sc">+</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(type <span class="sc">~</span> typo_insee) <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogramme des surfaces par type de commune"</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Surface"</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Fréquence"</span>) <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="analyses-à-léchelle-des-epci" class="level2">
<h2 class="anchored" data-anchor-id="analyses-à-léchelle-des-epci">Analyses à l’échelle des EPCI</h2>
<section id="récapitulatif-epci" class="level3">
<h3 class="anchored" data-anchor-id="récapitulatif-epci">Récapitulatif EPCI</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>EPCIDVF <span class="ot">&lt;-</span> MutationsDVF <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code_EPCI, nom_EPCI, type_EPCI) <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb =</span> <span class="fu">n</span>(),</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">prix =</span> <span class="fu">mean</span>(prix),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prixM2 =</span> <span class="fu">mean</span>(prixm2),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">nbmaisons =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Maison"</span>),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">nbapparts =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Appartement"</span>),</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">propmaison =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Maison"</span>)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">propappart =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Appartement"</span>)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">surface =</span> <span class="fu">mean</span>(surface)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'code_EPCI', 'nom_EPCI'. You can override
using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>EPCIDVF <span class="ot">&lt;-</span> EPCIDVF <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>EPCIDVFsynthese <span class="ot">&lt;-</span> MutationsDVF <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type_EPCI) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb =</span> <span class="fu">n</span>(),</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">prix =</span> <span class="fu">mean</span>(prix),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prixM2 =</span> <span class="fu">mean</span>(prixm2),</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">nbmaisons =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Maison"</span>),</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">nbapparts =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Appartement"</span>),</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">propmaison =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Maison"</span>)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">propappart =</span> <span class="fu">sum</span>(type <span class="sc">==</span> <span class="st">"Appartement"</span>)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">surface =</span> <span class="fu">mean</span>(surface)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>EPCIDVFsynthese <span class="ot">&lt;-</span> EPCIDVFsynthese <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(EPCIDVFsynthese)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 9
  type_EPCI           nb   prix prixM2 nbmaisons nbapparts propmaison propappart
  &lt;chr&gt;            &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;int&gt;     &lt;int&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 Communauté d'a… 330631 2.36e5  2940.    193569    137062       58.5       41.5
2 Communauté de … 318214 2.05e5  2331.    260293     57921       81.8       18.2
3 Communauté urb…  46524 2.00e5  2561.     23651     22873       50.8       49.2
4 Etablissement …  57395 3.88e5  5983.     13173     44222       23.0       77.0
5 Métropole       284187 3.22e5  4884.     74633    209554       26.3       73.7
# ℹ 1 more variable: surface &lt;dbl&gt;</code></pre>
</div>
</div>
<section id="graphiques-des-prix-par-type-depci" class="level4">
<h4 class="anchored" data-anchor-id="graphiques-des-prix-par-type-depci">Graphiques des prix par type d’EPCI</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(EPCIDVF, <span class="fu">aes</span>(<span class="at">x =</span> prixM2, <span class="at">fill =</span> type_EPCI)) <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span>  <span class="co"># Réglez la largeur des barres d'histogramme</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> type_EPCI, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span>  <span class="co"># Small multiples par NATURE</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogramme des prix par mètre carré par NATURE"</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Prix par mètre carré"</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Fréquence"</span>) <span class="sc">+</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="cartographie-exploratoire" class="level1">
<h1>Cartographie exploratoire</h1>
<section id="ajout-des-couches-géographiques" class="level3">
<h3 class="anchored" data-anchor-id="ajout-des-couches-géographiques">Ajout des couches géographiques</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>Communes <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"E:/AdminExpress/CommunesFrance.shp"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `CommunesFrance' from data source 
  `E:\AdminExpress\CommunesFrance.shp' using driver `ESRI Shapefile'
Simple feature collection with 34816 features and 13 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 99040 ymin: 6046546 xmax: 1242440 ymax: 7110479
Projected CRS: RGF93 Lambert 93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>ContourFrance <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"E:/AdminExpress/CONTOURS_FRANCE.shp"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `CONTOURS_FRANCE' from data source 
  `E:\AdminExpress\CONTOURS_FRANCE.shp' using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 99040 ymin: 6046546 xmax: 1242443 ymax: 7110479
Projected CRS: RGF93 Lambert 93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>Regions <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"E:/AdminExpress/REGION.shp"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `REGION' from data source `E:\AdminExpress\REGION.shp' using driver `ESRI Shapefile'
Simple feature collection with 13 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 99040 ymin: 6046546 xmax: 1242443 ymax: 7110479
Projected CRS: RGF93 Lambert 93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>EPCI <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"E:/AdminExpress/EPCI.shp"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `EPCI' from data source `E:\AdminExpress\EPCI.shp' using driver `ESRI Shapefile'
Simple feature collection with 1243 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 107388.8 ymin: 6046546 xmax: 1242443 ymax: 7110479
Projected CRS: RGF93 Lambert 93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>Communes<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(Communes, <span class="dv">2154</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>ContourFrance<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ContourFrance, <span class="dv">2154</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>EPCI<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(EPCI, <span class="dv">2154</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cartographie-à-léchelle-des-communes" class="level2">
<h2 class="anchored" data-anchor-id="cartographie-à-léchelle-des-communes">Cartographie à l’échelle des communes</h2>
<section id="jointure-attributaire-entre-récapitulatif-des-communes-et-la-couche-communes" class="level3">
<h3 class="anchored" data-anchor-id="jointure-attributaire-entre-récapitulatif-des-communes-et-la-couche-communes">Jointure attributaire entre récapitulatif des communes et la couche communes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>Communes <span class="ot">&lt;-</span> <span class="fu">merge</span>(Communes, CommunesDVF, <span class="at">by.x =</span> <span class="st">"INSEE_COM"</span>, <span class="at">by.y =</span> <span class="st">"code_com"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cartographie-des-prix-moyens-par-commune" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-des-prix-moyens-par-commune">Cartographie des prix moyens par commune</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> Communes,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"prix"</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="st">"quantile"</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbreaks =</span> <span class="dv">8</span>,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="st">"Tropic"</span>,</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">rev =</span> <span class="cn">TRUE</span>,</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#leg_pos = NA ,</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"Prix moyen par commune"</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> ContourFrance,</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Prix de l'immobilier résidentiel / Par commune"</span>,</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Sources: DGFIP-IGN, 2023"</span>)</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cartographie-des-prix-moyens-au-m2" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-des-prix-moyens-au-m2">Cartographie des prix moyens au m2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> Communes,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"prixM2"</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="dv">1500</span>, <span class="dv">1800</span>, <span class="dv">2200</span>, <span class="dv">3000</span>, <span class="fu">max</span>(Communes<span class="sc">$</span>prixM2)),</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbreaks =</span> <span class="dv">6</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="st">"RdYlGn"</span>,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_pos =</span> <span class="cn">NA</span> ,</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"Prix  moyen au m2 </span><span class="sc">\n</span><span class="st">par commune"</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> ContourFrance,</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Prix de l'immobilier résidentiel / Par commune"</span>,</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Sources: DGFIP-IGN, 2023"</span>)</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="histogramme-de-distribution-de-la-variable" class="level4">
<h4 class="anchored" data-anchor-id="histogramme-de-distribution-de-la-variable">Histogramme de distribution de la variable</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>my_breaks <span class="ot">&lt;-</span> <span class="fu">hist</span>(Communes<span class="sc">$</span>prixM2,<span class="at">breaks=</span><span class="dv">100</span>)<span class="sc">$</span>breaks   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>my_colors <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"#006228"</span>, <span class="fu">length</span>(my_breaks))      </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">1200</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">1500</span>] <span class="ot">&lt;-</span> <span class="st">"#6AAB44"</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">1500</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">1800</span>] <span class="ot">&lt;-</span> <span class="st">"#D7E88D"</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">1800</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">2200</span>] <span class="ot">&lt;-</span> <span class="st">"#F6DE90"</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">2200</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">3000</span>] <span class="ot">&lt;-</span> <span class="st">"#E78200"</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">3000</span>] <span class="ot">&lt;-</span> <span class="st">"#A51122"</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Communes<span class="sc">$</span>prixM2,                                        </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> my_breaks,</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Prix moyen au m2"</span>,</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> my_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-56-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="cartographie-de-labordabilité" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-de-labordabilité">Cartographie de l’abordabilité</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> Communes,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"affordabilite"</span>,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="dv">1</span>, <span class="fl">1.1</span>, <span class="fl">1.2</span>, <span class="fl">1.3</span>, <span class="fu">max</span>(Communes<span class="sc">$</span>affordabilite)),</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbreaks =</span> <span class="dv">10</span>,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="st">"Geyser"</span>,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">rev =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#leg_pos = NA ,</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"Mois de salaire (médian) </span><span class="sc">\n</span><span class="st"> nécessaires pour acheter 1m²"</span>)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> ContourFrance,</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Abordabilité de l'immobilier résidentiel / Par commune"</span>,</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Sources: DGFIP-IGN, 2023"</span>)</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="histrogramme-de-distribution-de-la-variable" class="level3">
<h3 class="anchored" data-anchor-id="histrogramme-de-distribution-de-la-variable">Histrogramme de distribution de la variable</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>my_breaks <span class="ot">&lt;-</span> <span class="fu">hist</span>(Communes<span class="sc">$</span>affordabilite,<span class="at">breaks=</span><span class="dv">100</span>)<span class="sc">$</span>breaks   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>my_colors <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"#008585"</span>, <span class="fu">length</span>(my_breaks))      </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="fl">0.7</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="fl">0.9</span>] <span class="ot">&lt;-</span> <span class="st">"#75a992"</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="fl">1.1</span>] <span class="ot">&lt;-</span> <span class="st">"#b8cdae"</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="fl">1.1</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="fl">1.3</span>] <span class="ot">&lt;-</span> <span class="st">"#fbf2c4"</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="fl">1.3</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="fl">1.5</span>] <span class="ot">&lt;-</span> <span class="st">"#d78d4c"</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="fl">1.5</span>] <span class="ot">&lt;-</span> <span class="st">"#c7522b"</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Communes<span class="sc">$</span>affordabilite,                                        </span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> my_breaks,</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Prix moyen au m2"</span>,</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> my_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-58-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="cartographie-à-léchelle-des-epci" class="level2">
<h2 class="anchored" data-anchor-id="cartographie-à-léchelle-des-epci">Cartographie à l’échelle des EPCI</h2>
<section id="jointure-attributaire-entre-récapitulatif-des-epci-et-la-couche-epci" class="level3">
<h3 class="anchored" data-anchor-id="jointure-attributaire-entre-récapitulatif-des-epci-et-la-couche-epci">Jointure attributaire entre récapitulatif des EPCI et la couche EPCI</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>EPCI <span class="ot">&lt;-</span> <span class="fu">merge</span>(EPCI, EPCIDVF, <span class="at">by.x =</span> <span class="st">"CODE_SIREN"</span>, <span class="at">by.y =</span> <span class="st">"code_EPCI"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cartographie-du-volume-de-mutations-par-epci" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-du-volume-de-mutations-par-epci">Cartographie du volume de mutations par EPCI</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du fond de carte des départements</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> EPCI,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"grey"</span>, </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.3</span>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> EPCI,</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"prop"</span>,</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">var =</span> <span class="st">"nb"</span>,</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">inches =</span> <span class="fl">0.25</span>,</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"red4"</span>,</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>,</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.002</span>,</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="st">"Nombre de mutations par EPCI"</span>)</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Nb de mutations par EPCI"</span>,</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">credits =</span> <span class="fu">paste0</span>(</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sources: DGFIP-IGN, 2023"</span></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> ContourFrance,</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cartographie-du-volume-de-maisons-et-prix-moyen-au-m2" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-du-volume-de-maisons-et-prix-moyen-au-m2">Cartographie du volume de maisons et prix moyen au m2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du fond de carte des départements</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> EPCI,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"grey85"</span>, </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.3</span>)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> EPCI,</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="fu">c</span>(<span class="st">"nbmaisons"</span>, <span class="st">"prix"</span>),</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"prop_choro"</span>,</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="st">"grey50"</span>,</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">inches =</span> <span class="fl">0.15</span>,</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fl">0.1</span>,</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="st">"topright"</span>, <span class="st">"right"</span>),</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="fu">c</span>(<span class="st">"Nb de ventes"</span>, <span class="st">"Prix moyen"</span>),</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="st">"quantile"</span>,</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbreaks =</span> <span class="dv">5</span>,</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="st">"RdYlGn"</span>,</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_val_rnd =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_frame =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> ContourFrance,</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Nombre de maisons vendues et prix moyen au m2"</span>,</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Sources: DGFIP-IGN, 2023"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cartographie-du-volume-dappartements-vendus-et-prix-moyen-au-m2" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-du-volume-dappartements-vendus-et-prix-moyen-au-m2">Cartographie du volume d’appartements vendus et prix moyen au m2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du fond de carte des départements</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> EPCI,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"grey85"</span>, </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.3</span>)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> EPCI,</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="fu">c</span>(<span class="st">"nbapparts"</span>, <span class="st">"prix"</span>),</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"prop_choro"</span>,</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="st">"grey50"</span>,</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">inches =</span> <span class="fl">0.2</span>,</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fl">0.1</span>,</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_pos =</span> <span class="fu">c</span>(<span class="st">"topright"</span>, <span class="st">"right"</span>),</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="fu">c</span>(<span class="st">"Nb de ventes"</span>, <span class="st">"Prix moyen au m2"</span>),</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="st">"quantile"</span>,</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbreaks =</span> <span class="dv">5</span>,</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="st">"RdYlGn"</span>,</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_val_rnd =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_frame =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> ContourFrance,</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(</span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Volume des appartements et prix moyen"</span>,</span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Sources: DGFIP-IGN, 2023"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cartographie-des-prix-moyens-par-epci" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-des-prix-moyens-par-epci">Cartographie des prix moyens par EPCI</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> EPCI,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"prix"</span>,</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="st">"quantile"</span>,</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbreaks =</span> <span class="dv">6</span>,</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="st">"Tropic"</span>,</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_pos =</span> <span class="st">"topright"</span>,</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"Prix  moyen au par EPCI"</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> ContourFrance,</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> Regions,</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(</span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Prix de l'immobilier résidentiel / par EPCI"</span>,</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Sources: DGFIP-IGN, 2023"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cartographie-des-prix-moyens-au-m2-par-epci" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-des-prix-moyens-au-m2-par-epci">Cartographie des prix moyens au m2 par EPCI</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> EPCI,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"prixM2"</span>,</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="dv">1400</span>, <span class="dv">1800</span>, <span class="dv">2200</span>, <span class="dv">3000</span>, <span class="fu">max</span>(EPCI<span class="sc">$</span>prixM2)),</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbreaks =</span> <span class="dv">6</span>,</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="st">"RdYlGn"</span>,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_pos =</span> <span class="st">"topright"</span>,</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"Prix  moyen au m2 par EPCI"</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> ContourFrance,</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> Regions,</span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(</span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Prix de l'immobilier résidentiel / Par EPCI"</span>,</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">credits =</span> <span class="fu">paste0</span>( <span class="st">"Sources: DGFIP-IGN, 2023"</span>)</span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="histogramme-de-distribution-de-la-variable-1" class="level4">
<h4 class="anchored" data-anchor-id="histogramme-de-distribution-de-la-variable-1">Histogramme de distribution de la variable</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>my_breaks <span class="ot">&lt;-</span> <span class="fu">hist</span>(EPCI<span class="sc">$</span>prixM2,<span class="at">breaks=</span><span class="dv">100</span>)<span class="sc">$</span>breaks   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>my_colors <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"#006228"</span>, <span class="fu">length</span>(my_breaks))      </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">1200</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">1500</span>] <span class="ot">&lt;-</span> <span class="st">"#6AAB44"</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">1500</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">1800</span>] <span class="ot">&lt;-</span> <span class="st">"#D7E88D"</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">1800</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">2200</span>] <span class="ot">&lt;-</span> <span class="st">"#F6DE90"</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">2200</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">3000</span>] <span class="ot">&lt;-</span> <span class="st">"#E78200"</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">3000</span>] <span class="ot">&lt;-</span> <span class="st">"#A51122"</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(EPCI<span class="sc">$</span>prixM2,                                        </span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> my_breaks,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Prix moyen au m2"</span>,</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> my_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-65-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="analyse-spatiale" class="level1">
<h1>Analyse spatiale</h1>
<section id="dataset-spatial-des-mutations" class="level3">
<h3 class="anchored" data-anchor-id="dataset-spatial-des-mutations">Dataset spatial des mutations</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>DVFgeo<span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(MutationsDVF, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>), <span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>DVFgeo<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(DVFgeo, <span class="dv">2154</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analyses-par-carroyages" class="level2">
<h2 class="anchored" data-anchor-id="analyses-par-carroyages">Analyses par carroyages</h2>
<section id="créer-une-grille-avec-des-mailles-de-5km" class="level3">
<h3 class="anchored" data-anchor-id="créer-une-grille-avec-des-mailles-de-5km">Créer une grille avec des mailles de 5km</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>grille <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(Communes, <span class="at">cellsize =</span> <span class="dv">10000</span>, <span class="at">crs =</span> <span class="dv">2154</span>, <span class="at">what =</span> <span class="st">"polygons"</span>, <span class="at">square =</span> <span class="cn">TRUE</span>) </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>grille <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(grille) </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>grille <span class="ot">&lt;-</span> grille <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">IDOK =</span> <span class="fu">row_number</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="agrégation-spatiale-sur-le-carroyage-compte-prix-et-prix-au-m2" class="level3">
<h3 class="anchored" data-anchor-id="agrégation-spatiale-sur-le-carroyage-compte-prix-et-prix-au-m2">Agrégation spatiale sur le carroyage (compte, prix et prix au m2)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># --&gt; calcul potentiellement long selon la précision du maillage</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>grilleDVF <span class="ot">&lt;-</span> grille <span class="sc">%&gt;%</span> <span class="fu">st_join</span>(DVFgeo) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(IDOK) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Nb_Mutations =</span> <span class="fu">n</span>(), <span class="at">prixm2moyen =</span> <span class="fu">mean</span>(prixm2), <span class="at">prixmoyen =</span> <span class="fu">mean</span>(prix))</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>grilleDVF <span class="ot">&lt;-</span> grilleDVF <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ecrire-le-jeu-de-données-en-gpkg-pour-un-usage-dans-un-logiciel-sig-chargement-du-dataset" class="level3">
<h3 class="anchored" data-anchor-id="ecrire-le-jeu-de-données-en-gpkg-pour-un-usage-dans-un-logiciel-sig-chargement-du-dataset">Ecrire le jeu de données en GPKG pour un usage dans un logiciel SIG / Chargement du dataset</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">#st_write(grilleDVF, "grille3km.gpkg", append = FALSE)</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co">#grilleDVF &lt;- st_read(dsn = "C:/Users/mericskay_b/Desktop/R/DVF/grille3km.gpkg", stringsAsFactors = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cartographie-des-prix-moyens-au-m2-1" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-des-prix-moyens-au-m2-1">Cartographie des prix moyens au m2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> grilleDVF,</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"prixm2moyen"</span>,</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>, <span class="dv">1400</span>, <span class="dv">1800</span>, <span class="dv">2200</span>, <span class="dv">3000</span>, <span class="fu">max</span>(grilleDVF<span class="sc">$</span>prixm2moyen)),</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbreaks =</span> <span class="dv">6</span>,</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="st">"RdYlGn"</span>,</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_pos =</span> <span class="st">"topright"</span>,</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"Prix  moyen au m2 "</span>)</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> ContourFrance,</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(  <span class="at">title =</span> <span class="st">"Prix de l'immobilier résidentiel / Par carreaux de 5km"</span>,</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Sources: DGFIP-IGN, 2023"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="histogramme-de-distribution-de-la-variable-2" class="level4">
<h4 class="anchored" data-anchor-id="histogramme-de-distribution-de-la-variable-2">Histogramme de distribution de la variable</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>my_breaks <span class="ot">&lt;-</span> <span class="fu">hist</span>(grilleDVF<span class="sc">$</span>prixm2moyen,<span class="at">breaks=</span><span class="dv">100</span>)<span class="sc">$</span>breaks   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>my_colors <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"#006228"</span>, <span class="fu">length</span>(my_breaks))      </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">1200</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">1500</span>] <span class="ot">&lt;-</span> <span class="st">"#6AAB44"</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">1500</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">1800</span>] <span class="ot">&lt;-</span> <span class="st">"#D7E88D"</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">1800</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">2200</span>] <span class="ot">&lt;-</span> <span class="st">"#F6DE90"</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">2200</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">3000</span>] <span class="ot">&lt;-</span> <span class="st">"#E78200"</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">3000</span>] <span class="ot">&lt;-</span> <span class="st">"#A51122"</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(grilleDVF<span class="sc">$</span>prixm2moyen,                                        </span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> my_breaks,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> my_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-71-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="cartographie-des-prix-moyens" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-des-prix-moyens">Cartographie des prix moyens</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> grilleDVF,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"prixmoyen"</span>,</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="st">"quantile"</span>,</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbreaks =</span> <span class="dv">6</span>,</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="st">"Tropic"</span>,</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">rev=</span><span class="cn">TRUE</span>,</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_pos =</span> <span class="st">"topright"</span>,</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_title =</span> <span class="st">"Prix  moyen au m2 "</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> ContourFrance,</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"base"</span>,</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">0.02</span>,</span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Prix de l'immobilier résidentiel par carreaux de 5km"</span>,</span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">credits =</span> <span class="fu">paste0</span>(</span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sources: DGFIP-IGN, 2023"</span></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="lissage-spatial-à-partir-des-prix-moyen-des-communes" class="level2">
<h2 class="anchored" data-anchor-id="lissage-spatial-à-partir-des-prix-moyen-des-communes">Lissage spatial à partir des prix moyen des communes</h2>
<section id="création-du-jeux-de-données-centroides-des-communes" class="level3">
<h3 class="anchored" data-anchor-id="création-du-jeux-de-données-centroides-des-communes">Création du jeux de données (centroides des communes)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>Communeslissage <span class="ot">&lt;-</span> Communes </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>Communeslissage <span class="ot">&lt;-</span> Communeslissage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(prixM2 <span class="sc">&gt;</span><span class="dv">10000</span> <span class="sc">&amp;</span> nb <span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>Communeslissagecentro <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(Communeslissage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>Communeslissagecentro<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(Communeslissagecentro, <span class="dv">2154</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>Communeslissagecentro <span class="ot">&lt;-</span> Communeslissagecentro[<span class="fu">complete.cases</span>(Communeslissagecentro<span class="sc">$</span>prixM2),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calcul-des-paramètres-du-lissage" class="level3">
<h3 class="anchored" data-anchor-id="calcul-des-paramètres-du-lissage">Calcul des paramètres du lissage</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identification du plus proche voisin de chaque commune</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>listPPV <span class="ot">&lt;-</span> <span class="fu">knearneigh</span>(Communeslissagecentro, <span class="at">k =</span> <span class="dv">1</span>) <span class="co"># pour connaître le plus proche voisin de chaque commune</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>PPV <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(listPPV, <span class="at">row.names =</span> Communeslissagecentro<span class="sc">$</span>INSEE_COM) <span class="co"># pour convertir l'objet knn en objet nb</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>distPPV <span class="ot">&lt;-</span> <span class="fu">nbdists</span>(PPV, Communeslissagecentro) <span class="co"># pour connaître la distance entre plus proches voisins</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour afficher un résumé statistique et l'histogramme des distances au plus proche voisin</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">summary</span>(<span class="fu">unlist</span>(distPPV))))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Min.  1st Qu.   Median     Mean  3rd Qu.     Max.
1 139.5954 2265.006 2861.825 3067.675 3672.447 23825.39</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">unlist</span>(distPPV), <span class="at">breaks =</span> <span class="dv">20</span>,</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Distance au plus proche voisin"</span>,</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">border =</span> <span class="st">"white"</span>, <span class="at">xlab =</span> <span class="st">"Distance"</span>, <span class="at">ylab =</span> <span class="st">"Fréquence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pour créer un objet ppp (format spatstat) et y intégrer dedans l'emprise et les valeurs à lisser (prix moyen au m²)</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(Communeslissagecentro)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>DVF.ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> coordinates[, <span class="dv">1</span>], <span class="at">y =</span> coordinates[, <span class="dv">2</span>], <span class="at">window =</span> Emprise, <span class="at">marks =</span> Communeslissagecentro<span class="sc">$</span>prixM2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 8 points were rejected as lying outside the specified window</code></pre>
</div>
</div>
</section>
<section id="lissage-spatial" class="level3">
<h3 class="anchored" data-anchor-id="lissage-spatial">Lissage spatial</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pour calculer la surface lissée (rayon lissage : 3 km et résolution spatiale de l'image : 5 ha) --&gt; calcul long dépendand de la précision choisie</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>cartelissee <span class="ot">&lt;-</span> <span class="fu">Smooth</span>(DVF.ppp, <span class="at">sigma =</span> <span class="dv">3000</span>, <span class="at">weights =</span> DVF.ppp<span class="sc">$</span>marks, <span class="at">eps =</span> <span class="dv">5000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Numerical underflow detected: sigma is probably too small</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion de la surface lissée au format raster</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>cartelissee.raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(cartelissee)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(cartelissee.raster) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(Communes)<span class="sc">$</span>srid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cartographie-du-lissage-spatial" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-du-lissage-spatial">Cartographie du lissage spatial</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Paramétrage des classes (breaks) et des couleurs</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>bks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1500</span>, <span class="dv">2000</span>, <span class="dv">2500</span>, <span class="dv">3000</span>, <span class="dv">4000</span>, <span class="dv">15000</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#006228"</span>, <span class="st">"#6AAB44"</span>, <span class="st">"#D7E88D"</span>, <span class="st">"#F6DE90"</span>, <span class="st">"#E78200"</span>, <span class="st">"#A51122"</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Paramétrage des marges de la fenêtre pour maximiser l'emprise de la carte</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage des communes de RM et alentours en arrière-plan et centrage de la carte sur Rennes Métropole</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(ContourFrance), <span class="at">lwd =</span> <span class="fl">0.1</span>, <span class="at">col =</span> <span class="st">"grey95"</span>, <span class="at">border =</span> <span class="st">"white"</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fu">st_bbox</span>(ContourFrance)[<span class="dv">1</span>], <span class="fu">st_bbox</span>(ContourFrance)[<span class="dv">3</span>]), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">st_bbox</span>(ContourFrance)[<span class="dv">2</span>], <span class="fu">st_bbox</span>(ContourFrance)[<span class="dv">4</span>]))</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage de la carte lissée et du contour des IRIS</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cartelissee.raster, <span class="at">breaks =</span> bks, <span class="at">col =</span> cols, <span class="at">legend =</span> <span class="cn">FALSE</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ContourFrance<span class="sc">$</span>geometry, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>,  <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage de la carte lissée et du contour des IRIS</span></span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cartelissee.raster, <span class="at">breaks =</span> bks, <span class="at">col =</span> cols, <span class="at">legend =</span> <span class="cn">FALSE</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Regions<span class="sc">$</span>geometry, <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">1</span>,  <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Légende</span></span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a><span class="fu">legendChoro</span>(</span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos =</span> <span class="st">"bottomleft"</span>,</span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">title.txt =</span> <span class="st">"Prix moyen </span><span class="sc">\n</span><span class="st">au m² (Euros)"</span>,</span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> bks, </span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">nodata =</span> <span class="cn">FALSE</span>,</span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">values.rnd =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="st">"white"</span>,</span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> cols</span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="histogramme-de-distribution" class="level4">
<h4 class="anchored" data-anchor-id="histogramme-de-distribution">Histogramme de distribution</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>my_breaks <span class="ot">&lt;-</span> <span class="fu">hist</span>(cartelissee.raster,<span class="at">breaks=</span><span class="dv">100</span>)<span class="sc">$</span>breaks   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>my_colors <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"#006228"</span>, <span class="fu">length</span>(my_breaks))      </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">1500</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">2000</span>] <span class="ot">&lt;-</span> <span class="st">"#6AAB44"</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">2000</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">2500</span>] <span class="ot">&lt;-</span> <span class="st">"#D7E88D"</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">2500</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">3000</span>] <span class="ot">&lt;-</span> <span class="st">"#F6DE90"</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">3000</span> <span class="sc">&amp;</span> my_breaks <span class="sc">&lt;=</span> <span class="dv">3500</span>] <span class="ot">&lt;-</span> <span class="st">"#E78200"</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>my_colors[my_breaks <span class="sc">&gt;</span> <span class="dv">3500</span>] <span class="ot">&lt;-</span> <span class="st">"#A51122"</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(cartelissee.raster,                                        </span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> my_breaks,</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Prix moyen au m2"</span>,</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> my_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-81-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="analyse-statistique" class="level1">
<h1>Analyse statistique</h1>
<p>L’identification et la délimitation géographique de sous marchés regroupant des communes présentant des caractéristiques similaires permet de saisir plus en profondeur les dynamiques immobilières et leur inscription spatiale. Nous proposons ici une segmentation du marché immobilier résidentiel français à l’échelon intercommunal, qui repose sur une méthode de <strong>classification ascendante hiérarchique</strong> (CAH)</p>
<p>Cette technique de partitionnement statistique permet de révéler les différences spatiales locales en regroupant les 1185 EPCI en classes homogènes. La CAH permet d’affiner les explorations par l’analyse simultanée de plusieurs variables</p>
<section id="segmentation-des-sous-marchés-immobiliers-à-léchelle-des-epci-par-cah" class="level2">
<h2 class="anchored" data-anchor-id="segmentation-des-sous-marchés-immobiliers-à-léchelle-des-epci-par-cah">Segmentation des sous-marchés immobiliers à l’échelle des EPCI par CAH</h2>
<section id="préparation-du-jeu-de-données-1" class="level3">
<h3 class="anchored" data-anchor-id="préparation-du-jeu-de-données-1">Préparation du jeu de données</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>EPCICAH <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(EPCIDVF) </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>EPCICAH <span class="ot">&lt;-</span> EPCICAH <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>() </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>CAHdf <span class="ot">&lt;-</span> EPCICAH <span class="sc">%&gt;%</span> <span class="fu">select</span>(prix, prixM2, propmaison, propappart, surface)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="variables-centrées-réduites" class="level3">
<h3 class="anchored" data-anchor-id="variables-centrées-réduites">Variables centrées-réduites</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>CAH <span class="ot">&lt;-</span> <span class="fu">scale</span>(CAHdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="réaliser-lacp" class="level3">
<h3 class="anchored" data-anchor-id="réaliser-lacp">Réaliser l’ACP</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">PCA</span>(CAH, <span class="at">graph =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-84-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="réalisez-une-cah-sur-les-composantes-principales-cp" class="level3">
<h3 class="anchored" data-anchor-id="réalisez-une-cah-sur-les-composantes-principales-cp">Réalisez une CAH sur les composantes principales (CP)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>cah_result <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(CAH)) </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(cah_result, <span class="at">k =</span> <span class="dv">6</span>) </span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>EPCIDVF<span class="sc">$</span>Cluster <span class="ot">&lt;-</span> clusters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tableau-reapitulatif-des-groupes" class="level3">
<h3 class="anchored" data-anchor-id="tableau-reapitulatif-des-groupes">Tableau reapitulatif des groupes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>RecapCAHEPCI <span class="ot">&lt;-</span> EPCIDVF <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Cluster) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">NbEPCI=</span> <span class="fu">n</span>(), <span class="at">Prixmoyen =</span> <span class="fu">mean</span>(prix), <span class="at">Prixm2moyen =</span> <span class="fu">mean</span>(prixM2),<span class="at">Surfacemoyen =</span> <span class="fu">mean</span>(surface), <span class="at">PropMaison =</span> <span class="fu">mean</span>(propmaison), <span class="at">PropAppart=</span> <span class="fu">mean</span>(propappart))</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(RecapCAHEPCI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  Cluster NbEPCI Prixmoyen Prixm2moyen Surfacemoyen PropMaison PropAppart
    &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1       1    158   216364.       2958.         74.9       45.5      54.5 
2       2    880   161056.       1691.         97.8       90.2       9.84
3       3     91   336129.       3649.         95.1       76.6      23.4 
4       4      5   567430.       5168.        111.        85.8      14.2 
5       5     28   300303.       4955.         61.3       23.2      76.8 
6       6     20   479936.       6271.         75.8       31.3      68.7 </code></pre>
</div>
</div>
</section>
<section id="graphique-de-variations-à-la-moyenne" class="level3">
<h3 class="anchored" data-anchor-id="graphique-de-variations-à-la-moyenne">Graphique de variations à la moyenne</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>CAHEPCI <span class="ot">&lt;-</span> RecapCAHEPCI <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Moy_Surface =</span> <span class="fu">mean</span>(EPCIDVF<span class="sc">$</span>surface),</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Moy_Prix =</span> <span class="fu">mean</span>(EPCIDVF<span class="sc">$</span>prix),</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Moy_Prixm2 =</span> <span class="fu">mean</span>(EPCIDVF<span class="sc">$</span>prixM2),</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Moy_PropMaisons =</span> <span class="fu">mean</span>(EPCIDVF<span class="sc">$</span>propmaison),</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Moy_PropApparts =</span> <span class="fu">mean</span>(EPCIDVF<span class="sc">$</span>propappart),</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Prix=</span>(Prixmoyen<span class="sc">-</span> Moy_Prix)<span class="sc">/</span>Moy_Prix<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Prixm2=</span>(Prixm2moyen<span class="sc">-</span> Moy_Prixm2)<span class="sc">/</span>Moy_Prixm2<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Surface=</span>(Surfacemoyen<span class="sc">-</span>Moy_Surface)<span class="sc">/</span>Moy_Surface<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">PropMaison=</span>(PropMaison<span class="sc">-</span>Moy_PropMaisons)<span class="sc">/</span>Moy_PropMaisons<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">PropAppart=</span>(PropAppart<span class="sc">-</span>Moy_PropApparts)<span class="sc">/</span>Moy_PropApparts<span class="sc">*</span><span class="dv">100</span>)   </span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>CAHEPCI <span class="ot">&lt;-</span> CAHEPCI <span class="sc">%&gt;%</span> <span class="fu">select</span>(Cluster, Prix, Prixm2, Surface, PropMaison, PropAppart) </span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>gather <span class="ot">&lt;-</span> CAHEPCI <span class="sc">%&gt;%</span> <span class="fu">gather</span>(<span class="at">key=</span>variable, <span class="at">value=</span> <span class="st">"value"</span>, Prix<span class="sc">:</span>PropAppart)</span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>gather<span class="sc">$</span>Cluster <span class="ot">&lt;-</span> <span class="fu">as.character</span>(gather<span class="sc">$</span>Cluster) </span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gather, <span class="fu">aes</span>(<span class="at">x=</span>variable, <span class="at">y=</span>value, <span class="at">fill=</span>Cluster)) <span class="sc">+</span>   <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span>   <span class="fu">coord_flip</span>() <span class="sc">+</span>   <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#ff851b"</span>,<span class="st">"#39a699"</span>,<span class="st">"#FF4136"</span>,<span class="st">"#f9c155"</span>,<span class="st">"#1f78b4"</span>,<span class="st">"#2cb1e3"</span>)) <span class="sc">+</span>   <span class="fu">ylab</span>(<span class="st">"Variation a la moyenne (%)"</span>) <span class="sc">+</span>   <span class="fu">theme_bw</span>() <span class="sc">+</span>   <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span>   <span class="fu">facet_wrap</span>(<span class="sc">~</span>Cluster, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cartographie-de-la-cah" class="level3">
<h3 class="anchored" data-anchor-id="cartographie-de-la-cah">Cartographie de la CAH</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>EPCI <span class="ot">&lt;-</span> <span class="fu">merge</span>(EPCI, EPCIDVF, <span class="at">by.x =</span> <span class="st">"CODE_SIREN"</span>, <span class="at">by.y =</span> <span class="st">"code_EPCI"</span>)  </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_theme</span>(<span class="st">"default"</span>)  </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(   <span class="at">x =</span> EPCI,   <span class="at">var =</span> <span class="st">"Cluster"</span>,   <span class="at">type =</span> <span class="st">"typo"</span>,   </span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"#FF4136"</span>,<span class="st">"#f9c155"</span>,<span class="st">"#416979"</span>,<span class="st">"#39a699"</span>,<span class="st">"#FF851B"</span>,<span class="st">"#2cb1e3"</span>), </span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">val_order =</span> <span class="fu">c</span>( <span class="st">"6"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>,<span class="st">"2"</span>,<span class="st">"5"</span>,<span class="st">"1"</span>), </span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">border =</span> <span class="st">"grey"</span>,   <span class="at">lwd =</span> <span class="fl">0.01</span>,   </span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">leg_pos =</span> <span class="st">"topright"</span>,   </span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">leg_title =</span> <span class="st">"Typologie des sous-marchés"</span> )  </span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Sous-marchés de l'immobilier résidentiel"</span>, </span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Sources: DGFIP-IGN, 2023"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="DVF_France_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="section" class="level1">
<h1></h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>